---
- name: install nginx on servera
  hosts: servers
  remote_user: root

  tasks: 
    - name: Gather the package facts
      ansible.builtin.package_facts:
        manager: rpm

    - name: check if nginx is installed
      ansible.builtin.debug:
        msg: "nginx is already installed!"
      when: "'nginx' in ansible_facts.packages"

    - name: install nginx
      dnf: 
         name: nginx
         state: latest
      when: "'nginx' not in ansible_facts.packages"

    - name: start nginx service
      service: 
         name: nginx
         state: started
         enabled: yes
      
    - name: install git
      dnf:
         name: git
         state: present

    - name: open port 80 in the firewall for nginx
      shell: firewall-cmd --zone=public --add-port=80/tcp --permanent
        
    - name: reload firewall
      shell: firewall-cmd --reload
         
